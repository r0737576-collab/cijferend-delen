<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Staartdeling — klassiek haakje</title>
<meta name="description" content="Interactieve staartdelingen met klassiek haakje; automatisch gekozen sommen, rood‑gemarkeerde fouten met uitleg, controle, en optioneel tot 0,001." />
<style>
  /* ====== Basis ====== */
  :root{
    --ink:#111; --muted:#667085; --grid:#e5e7eb; --accent:#1f6feb;
    --ok:#15803d; --err:#b91c1c; --paper:#ffffff; --chip:#f6f8fa;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:#fafafa;color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans",Arial,sans-serif}
  header{padding:.9rem 1rem;border-bottom:1px solid var(--grid);background:#fff;position:sticky;top:0;z-index:10}
  h1{margin:0;font-size:1.35rem}
  .sub{margin:.2rem 0 0;color:var(--muted);font-size:.95rem}

  /* ====== Compacte toolbar (instellingen) ====== */
  .toolbar{display:flex;gap:.75rem;align-items:center;flex-wrap:wrap;padding:.7rem 1rem;border-bottom:1px solid var(--grid);background:#fff}
  .group{display:flex;align-items:center;gap:.5rem;background:var(--chip);border:1px solid var(--grid);border-radius:.6rem;padding:.35rem .6rem}
  .group label{display:flex;align-items:center;gap:.35rem;font-size:.95rem;white-space:nowrap}
  .btns{margin-left:auto;display:flex;gap:.5rem;flex-wrap:wrap}
  button{border:1px solid var(--grid);background:#fff;border-radius:.55rem;padding:.45rem .7rem;cursor:pointer}
  button:hover{border-color:var(--accent)}
  main{padding:1rem}

  /* ====== Klassiek haakje-layout ====== */
  .lv{max-width:860px;background:var(--paper);border:1px solid var(--grid);border-radius:.8rem;padding:1rem;margin:auto}
  .lv-head{display:grid;grid-template-columns:auto 1fr;gap:.5rem;align-items:end}

  /* Haakje: deler links in box, rechts 'radical' met dikke bovenlijn en linkslijn */
  .lv-divisor{
    padding:.25rem .5rem;border:2px solid var(--ink);border-right:none;
    min-width:3.5rem;text-align:right;font-weight:700;background:#fff;border-top-left-radius:.3rem;border-bottom-left-radius:.3rem;
  }
  .lv-radical{position:relative;display:block;min-width:16rem}
  .lv-radical::before{ /* top-lijn van het haakje */
    content:"";position:absolute;left:0;right:0;top:-2px;height:2px;background:var(--ink);
  }
  .lv-radical::after{ /* linkse verticale lijn van het haakje */
    content:"";position:absolute;left:0;top:-2px;bottom:calc(100% - 2px);width:2px;background:var(--ink);
  }
  .lv-quot{position:absolute;left:.4rem;right:.4rem;bottom:100%;padding:0 .25rem .15rem .35rem;text-align:left;font-weight:700}
  .lv-quot input.dig{width:1.8ch;text-align:center;border:1px solid var(--grid);border-radius:.3rem;padding:.15rem .2rem;margin-right:.1rem}
  .comma{margin:0 .2rem}

  .lv-dividend{padding:.3rem .5rem .2rem .5rem;font-weight:700;min-height:2rem}

  /* ====== Werkzone (zoals op blad): per stap: product, streep, rest, 'laat zakken' */
  .steps{margin-top:.4rem;display:grid;gap:.6rem}
  .step{display:grid;grid-template-columns:auto 1fr;gap:.6rem}
  .step .nr{color:var(--muted);min-width:6rem}
  .work{display:grid;gap:.25rem}
  .prod-row,.rem-row,.bring-row{display:flex;align-items:center;gap:.4rem}
  .prod-row .label{color:#374151;min-width:6.5rem}
  .rem-row .label{color:#374151;min-width:6.5rem}
  .bring-row .label{color:#374151;min-width:6.5rem}
  .hline{height:2px;background:var(--ink);margin:.1rem 0 .2rem 0}
  input.num{width:9ch;text-align:right;border:1px solid var(--grid);border-radius:.35rem;padding:.28rem .4rem;background:#fff}

  .ok{background:#e8f5ea !important;border-color:#16a34a !important}
  .err{background:#fee2e2 !important;border-color:var(--err) !important}
  .hint{color:var(--muted);font-size:.95rem;margin:.2rem 0 0}

  /* ====== Controle-rooster ====== */
  details{margin-top:1rem}
  .check{border:1px solid var(--grid);border-radius:.6rem;padding:.75rem;background:#fff;max-width:860px}
  .check .row{display:grid;grid-template-columns:auto 1fr auto auto auto 1fr;gap:.35rem;align-items:center}
  .check .has-rest{grid-template-columns:auto 1fr auto 1fr}
  .check input{width:12ch;text-align:right;border:1px solid var(--grid);border-radius:.35rem;padding:.28rem .4rem;background:#fff}
  summary{cursor:pointer}

  /* Print */
  @media print{
    header,.toolbar,footer{display:none !important}
    main{padding:0}
    .lv,.check{border:none}
  }
</style>
</head>
<body>
  <header>
    <h1>Staartdeling</h1>
    <p class="sub">Klassieke uitwerking met haakje, producten, horizontale strepen, rest en “laat zakken”.</p>
  </header>

  <!-- Compacte instellingen naast elkaar -->
  <div class="toolbar" aria-label="Instellingen">
    <div class="group" role="radiogroup" aria-label="Oefeningstype">
      <label><input type="radio" name="rest" value="zonder" checked> uitkomst</label>
      <label><input type="radio" name="rest" value="met"> met rest</label>
    </div>
    <div class="group">
      <label><input type="checkbox" id="toDecimals"> tot <strong>0,001</strong></label>
    </div>
    <div class="group">
      <label><input type="checkbox" id="enableCheck"> controle</label>
    </div>

    <div class="btns">
      <button id="btnNew" type="button">Nieuwe oefening</button>
      <button id="btnCheck" type="button">Nakijken</button>
      <button id="btnSolution" type="button">Oplossing</button>
      <button id="btnReset" type="button">Wissen</button>
    </div>
  </div>

  <main>
    <section class="lv" id="lv" aria-label="Staartdeling">
      <div class="lv-head">
        <div class="lv-divisor" id="divisor">—</div>
        <div class="lv-radical">
          <div class="lv-quot" id="quot"></div>
          <div class="lv-dividend" id="dividend">—</div>
        </div>
      </div>
      <div class="steps" id="steps"></div>

      <details id="checkDetails">
        <summary>Controle‑rooster</summary>
        <div class="check" id="checkHost"></div>
      </details>
    </section>
  </main>

  <footer style="padding:1rem;color:#6b7280">
    <small>Tip: hover op een <span style="background:#fee2e2;border:1px solid #b91c1c;border-radius:.2rem;padding:.05rem .2rem;">rode cel</span> voor uitleg.</small>
  </footer>

<script>
(function(){
  const settings = { dividendMax: 10000, divisorMax: 20 };

  // DOM helpers
  const $ = sel => document.querySelector(sel);
  const $$ = sel => [...document.querySelectorAll(sel)];
  const dom = {
    rest: () => $$('input[name="rest"]').find(r=>r.checked).value,
    toDecimals: () => $('#toDecimals').checked,
    enableCheck: () => $('#enableCheck').checked,
    divisor: () => $('#divisor'),
    dividend: () => $('#dividend'),
    quot: () => $('#quot'),
    steps: () => $('#steps'),
    checkDetails: () => $('#checkDetails'),
    checkHost: () => $('#checkHost'),
    btnNew: () => $('#btnNew'),
    btnCheck: () => $('#btnCheck'),
    btnSolution: () => $('#btnSolution'),
    btnReset: () => $('#btnReset')
  };

  // Utilities
  const rnd = (min,max) => Math.floor(Math.random()*(max-min+1))+min;
  const pick = arr => arr[Math.floor(Math.random()*arr.length)];

  function generateProblem({wantNoRemainder, toDecimals}){
    let divisor = rnd(2, settings.divisorMax);
    let dividend;
    if (wantNoRemainder){
      const q = rnd(2, Math.max(2, Math.floor(settings.dividendMax / divisor)));
      dividend = divisor * q;
    } else {
      dividend = rnd(2, settings.dividendMax);
      if (dividend % divisor === 0) dividend += 1;
    }
    return { dividend, divisor, toDecimals };
  }

  function planDivision({dividend, divisor, toDecimals}){
    const digs = String(dividend).split('').map(n=>+n);
    const steps = [];
    let idx=0, curr=0;
    let qDigits=[];
    while(idx<digs.length){
      curr = curr*10 + digs[idx];
      const qd = Math.floor(curr/divisor);
      const prod = qd*divisor;
      const rem = curr - prod;
      steps.push({ stage:(idx+1), part: curr, qDigit: qd, prod, rem, bring: digs[idx+1] ?? null });
      qDigits.push(qd);
      curr = rem;
      idx++;
    }
    // trim leading zeros in quotient
    while(qDigits.length>1 && qDigits[0]===0){ qDigits.shift(); steps.shift(); }
    let remainder = curr;

    // Decimals to 3 if requested and remainder ≠ 0
    let decDigits=[];
    if (toDecimals && remainder!==0){
      let c=remainder;
      for(let i=0;i<3;i++){
        c*=10;
        const qd=Math.floor(c/divisor), prod=qd*divisor, rem=c-prod;
        steps.push({ stage:steps.length+1, part:c, qDigit:qd, prod, rem, bring:(i<2?0:null), isDec:true, decIndex:i+1 });
        decDigits.push(qd);
        c=rem;
        if (c===0) break;
      }
      remainder=c;
    }

    const qInt = (qDigits.length? qDigits.join('') : '0');
    const qStr = qInt + (decDigits.length? ','+decDigits.join(''):'');
    return { steps, qDigits, decDigits, remainder, qStr };
  }

  function clear(node){ node.innerHTML=''; }

  function buildQuotInputs(qWrap, plan){
    clear(qWrap);
    const makeBox = (exp) => {
      const i=document.createElement('input');
      i.type='text'; i.maxLength=1; i.inputMode='numeric'; i.className='dig';
      i.setAttribute('data-expected', exp);
      i.placeholder='·';
      return i;
    };
    plan.qDigits.forEach(d=> qWrap.appendChild(makeBox(d)));
    if (plan.decDigits.length){
      const span=document.createElement('span'); span.textContent=','; span.className='comma';
      qWrap.appendChild(span);
      plan.decDigits.forEach(d=> qWrap.appendChild(makeBox(d)));
    }
  }

  function buildSteps(container, divisor, plan){
    clear(container);
    plan.steps.forEach((s,i)=>{
      const step=document.createElement('div'); step.className='step';
      const nr=document.createElement('div'); nr.className='nr'; nr.textContent = s.isDec? `Stap ${i+1} (decimaal ${s.decIndex})` : `Stap ${i+1}`;
      const work=document.createElement('div'); work.className='work';

      // Productrij
      const prodRow=document.createElement('div'); prodRow.className='prod-row';
      const lab1=document.createElement('div'); lab1.className='label'; lab1.textContent='product:';
      const qIn=document.createElement('input'); qIn.className='num q'; qIn.placeholder=`q (${s.qDigit})`; qIn.setAttribute('data-exp', s.qDigit);
      const mult=document.createElement('span'); mult.textContent='×';
      const dSpan=document.createElement('span'); dSpan.textContent=String(divisor);
      const eq=document.createElement('span'); eq.textContent='=';
      const pIn=document.createElement('input'); pIn.className='num prod'; pIn.placeholder='q×d'; pIn.setAttribute('data-exp', s.prod);
      prodRow.append(lab1,qIn,mult,dSpan,eq,pIn);

      // Lijn + rest
      const hline=document.createElement('div'); hline.className='hline';
      const remRow=document.createElement('div'); remRow.className='rem-row';
      const lab2=document.createElement('div'); lab2.className='label'; lab2.textContent='rest:';
      const remIn=document.createElement('input'); remIn.className='num rem'; remIn.placeholder='rest'; remIn.setAttribute('data-exp', s.rem);
      const hint=document.createElement('div'); hint.className='hint'; hint.textContent=`${s.part} − (${divisor} × q) = rest`;
      remRow.append(lab2,remIn,hint);

      // Laat zakken
      const bring=document.createElement('div'); bring.className='bring-row';
      const lab3=document.createElement('div'); lab3.className='label'; lab3.textContent='laat zakken:';
      const bVal=document.createElement('div'); bVal.textContent = (s.bring===null)? '—' : String(s.bring);
      bring.append(lab3,bVal);

      work.append(prodRow,hline,remRow,bring);
      step.append(nr,work);
      container.append(step);
    });
  }

  function buildCheckUI(host, problem, plan){
    clear(host);
    const row1=document.createElement('div'); row1.className='row';
    const labQ=document.createElement('span'); labQ.textContent='quotiënt:';
    const qIn=document.createElement('input'); qIn.className='q-input'; qIn.placeholder='quotiënt';
    const times=document.createElement('span'); times.textContent='×';
    const d=document.createElement('span'); d.textContent=String(problem.divisor);
    const eq=document.createElement('span'); eq.textContent='=';
    const prodIn=document.createElement('input'); prodIn.className='prod-input'; prodIn.placeholder='product';
    row1.append(labQ,qIn,times,d,eq,prodIn);
    host.append(row1);

    if (plan.remainder!==0){
      const row2=document.createElement('div'); row2.className='row has-rest';
      const plusRest=document.createElement('span'); plusRest.textContent='+ rest:';
      const rIn=document.createElement('input'); rIn.className='r-input'; rIn.placeholder='rest';
      const eq2=document.createElement('span'); eq2.textContent='=';
      const sumIn=document.createElement('input'); sumIn.className='sum-input'; sumIn.placeholder='deeltal';
      row2.append(plusRest,rIn,eq2,sumIn);
      host.append(row2);
    }
    const hint=document.createElement('p'); hint.className='hint';
    hint.textContent='Vul quotiënt in, vermenigvuldig met de deler en tel er (indien nodig) de rest bij; resultaat is het deeltal.';
    host.append(hint);
  }

  function annotate(inp, ok, msg){
    inp.classList.remove('ok','err'); inp.removeAttribute('title');
    if (ok===true){ inp.classList.add('ok'); }
    if (ok===false){ inp.classList.add('err'); inp.title = msg || 'Fout'; }
  }

  function validate(current){
    // Quotiënt
    $$('#quot input.dig').forEach(inp=>{
      const exp = String(inp.dataset.expected);
      const got = (inp.value||'').trim();
      if (got==='') { annotate(inp,null); return; }
      annotate(inp, got===exp, got===exp?'':'Quotiënt‑cijfer klopt niet.');
    });
    // Stappen
    $$('#steps .step').forEach(step=>{
      const q = step.querySelector('.q');
      const prod = step.querySelector('.prod');
      const rem = step.querySelector('.rem');
      const d = +current.divisor;

      // q
      if (q.value.trim()!==''){
        const okQ = +q.value === +q.dataset.exp;
        annotate(q, okQ, `Kies het grootste q zodat ${d}×q ≤ deelbaar.`);
      }
      // product
      if (prod.value.trim()!==''){
        const okP = +prod.value === +prod.dataset.exp;
        const expQ = +q.dataset.exp;
        annotate(prod, okP, okP?'':`Product fout: ${expQ}×${d} = ${prod.dataset.exp}.`);
      }
      // rest
      if (rem.value.trim()!==''){
        const okR = +rem.value === +rem.dataset.exp;
        annotate(rem, okR, okR?'':`Rest fout: deelbaar − (d×q) = ${rem.dataset.exp}.`);
      }
    });
  }

  function fillSolution(){
    // Quotiënt
    $$('#quot input.dig').forEach(inp=> inp.value = inp.dataset.expected);
    // Stappen
    $$('#steps .step').forEach(step=>{
      step.querySelector('.q').value = step.querySelector('.q').dataset.exp;
      step.querySelector('.prod').value = step.querySelector('.prod').dataset.exp;
      step.querySelector('.rem').value = step.querySelector('.rem').dataset.exp;
    });
  }

  function validateCheck(host, problem, plan){
    const qI = host.querySelector('.q-input');
    const pI = host.querySelector('.prod-input');
    const rI = host.querySelector('.r-input');
    const sI = host.querySelector('.sum-input');

    const qVal = Number(String(plan.qStr).replace(',','.'));
    const targetProd = Math.floor(qVal * problem.divisor);

    if (qI && qI.value.trim()!==''){
      const ok = Number(String(qI.value).replace(',','.')) === qVal;
      annotate(qI, ok, ok?'':`Quotiënt = ${plan.qStr}`);
    }
    if (pI && pI.value.trim()!==''){
      annotate(pI, +pI.value===targetProd, `Product = ${targetProd}`);
    }
    if (rI){
      if (plan.remainder===0){
        if (sI && sI.value.trim()!==''){
          annotate(sI, +sI.value===problem.dividend, 'Bij uitkomst: product = deeltal');
        }
      } else {
        if (rI.value.trim()!==''){
          annotate(rI, +rI.value===plan.remainder, `Rest = ${plan.remainder}`);
        }
        if (sI && sI.value.trim()!==''){
          annotate(sI, +sI.value===problem.dividend, `Product + rest = ${problem.dividend}`);
        }
      }
    }
  }

  // State
  let currentProblem=null, currentPlan=null;

  function newExercise(){
    const wantNoRemainder = (dom.rest()==='zonder');
    const prob = generateProblem({ wantNoRemainder, toDecimals: dom.toDecimals() });
    const plan = planDivision(prob);

    // Koptitel
    dom.divisor().textContent = String(prob.divisor);
    dom.dividend().textContent = String(prob.dividend);

    // Quotiëntvakjes & stappen
    buildQuotInputs(dom.quot(), plan);
    buildSteps(dom.steps(), prob.divisor, plan);

    // Controle
    buildCheckUI(dom.checkHost(), prob, plan);
    dom.checkDetails().open = dom.enableCheck();

    currentProblem = prob; currentPlan = plan;
  }

  // Wire
  dom.btnNew().addEventListener('click', newExercise);
  dom.btnReset().addEventListener('click', ()=>{
    clear(dom.steps()); clear(dom.quot()); dom.dividend().textContent='—'; dom.divisor().textContent='—'; clear(dom.checkHost());
  });
  dom.btnSolution().addEventListener('click', ()=>{ if (!currentPlan) return; fillSolution(); validate(currentProblem); });
  dom.btnCheck().addEventListener('click', ()=>{
    if (!currentPlan) return;
    validate(currentProblem);
    validateCheck(dom.checkHost(), currentProblem, currentPlan);
  });
  // Schakelaar: controle tonen/verbergen
  $('#enableCheck').addEventListener('change', ()=> dom.checkDetails().open = dom.enableCheck());

  // Init
  newExercise();
})();
</script>
</body>
</html>
